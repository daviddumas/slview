<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>SL(View)</title>
  </head>
  <body>
    <style>
      body {
	  margin:0;
	  overscroll-behavior: contain;
      }
      canvas {
	  display: block;
	  position: absolute;
	  top: 0px;
	  left: 0px;
      }
    </style>

    <!-- SHADERS -->
    <script type="x-shader/x-vertex" id="vertexshader" src="shaders/particle.vert">
      attribute float m22;
      varying vec3 vColor;
      uniform float coordscale;
      uniform float sizescale;
      void main() {
	  float a = position.x;
	  float b = position.y;
	  float c = position.z;
	  float d = m22;

	  float t = a+d;
	  float isomtype = sign(t*t-4.0);

	  vColor = vec3(1.0,
			0.75 + 0.25*sign(isomtype+0.5),
			0.75 + 0.25*sign(isomtype-0.5));

  	  //  1    1 1 1
	  //  0    1 1 0
	  // -1    1 0 0

	  vec4 ns3 = normalize( vec4(a*a + b*b - c*c - d*d,
				     -2.0*(a*c + b*d),
				     2.0*(b - c)*(a + d),
				     (a + b - c + d)*(a - b + c + d)) );
	  
	  vec3 r3p = coordscale * ns3.xyz / (1.0 - ns3.w);
	  vec4 mvPosition = modelViewMatrix * vec4( r3p, 1.0 );

	  float s = sqrt( ((b+c)*(b+c) + (a-d)*(a-d)) / ((b-c)*(b-c) + (a+d)*(a+d)) );
	  s = sqrt(1.0-s) / (1.0-ns3.w);
	  
	  gl_PointSize = sizescale * s * ( 300.0 / -mvPosition.z );
	  gl_Position = projectionMatrix * mvPosition;
      }
    </script>
    <script type="x-shader/x-fragment" id="fragmentshader" src="shaders/particle.frag">
      uniform sampler2D pointTexture;
      varying vec3 vColor;
      uniform float alpha;
      void main() {
	  gl_FragColor = vec4( vColor, alpha );
	  gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );
      }
    </script>
    <!-- END SHADERS -->

    <script src="app.js" type="module"></script>

  </body>
</html>
